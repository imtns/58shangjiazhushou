<template>
    <scroll-view class="home" scroll-y style="height:100vh" wx:if="{{ !status.loading || !status.first }}">
        <view class="follow-public" wx:if="{{!isFollow}}">
            <text>关注公众号接收通知</text>
            <navigator class="follow-action" wx:if="{{assistAuth}}" url="/pages/followPublic">马上关注</navigator>
            <button class="follow-action" wx:elif="{{!assistAuth}}" open-type="getUserInfo" @tap="loadSession">马上关注</button>
        </view>
        <view class="index-loaded-header">
            <view class="welcome-block">
                <view class="welcome-title">欢迎 <text>{{ business.name }}</text></view>
                <navigator url="noticeList" :class="{'new-msg': business.unread}" class="msg-box'"></navigator>
            </view>
            <view class="item-detail">
                <view class="item-name" :class="{logoPadding : business.mpCount > 0 }">{{ business.miniProgramName }}</view>
                <view class="item-title" :class="{logoPadding : business.mpCount > 0 }">
                    <view class="star-box" wx:if="{{ business.selected.score }}">
                        <view class="unstar-list">
                            <view class="icon-unstar" wx:for="{{ [0, 1, 2, 3, 4] }}" wx:key="index"></view>
                        </view>
                        <view class="star-list"
                        style="width:{{ 30 * (~~(business.selected.score / 1)) + 22 * (business.selected.score % 1) }}rpx">
                            <view class="icon-star" wx:for="{{ [0, 1, 2, 3, 4] }}" wx:key="index"></view>
                        </view>
                        <navigator class="star-box-title" url="/pages/shopScore">店铺评分</navigator>
                    </view>
                    <view wx:else>可上传素材、提交注册信息到当前小程序</view>
                </view>
                <view @tap="changeAction" wx:if="{{business.mpCount >= 2}}" class="item-switch">切换</view>
                <image  class="haslogo" wx:if="{{business.mpCount > 0 }}" mode="{{aspectFit}}" src="{{business.selected.headImg ||'https://pic8.58cdn.com.cn/bizmp/n_v285d6a16d725a446694db35df23c9db24.png?w=375&h=375'}}"></image>
                <view class="index-block-body index-item">
                    <view class="index-loaded-item" wx:for="{{items}}" wx:key="index" bindtap="link({{item.text}})">
                        <image src="{{item.iconPath}}" class="item-img"></image>
                        <view class="item-text">{{item.text}}</view>
                    </view>
                </view>
                <view bindtap="checkProgress" class="item-detail-progress">
                    <view class="current-progress"></view>
                    <view class="remind-title">{{ business.progressText}}</view>
                </view>
            </view>
        </view>
        <view class="index-block"  wx:for="{{nItems}}" wx:for-item="nItem"  wx:key="{{nItem.title}}">
            <view class="index-block-title">{{nItem.title}}</view>
            <view class="index-block-body">
                <view class="index-loaded-item new-margin {{item.text === '店铺装修' ? 'shangxin' : ''}}" wx:for="{{nItem.items}}" wx:key="index" bindtap="link({{item.text}})">
                    <image src="{{item.iconPath}}" class="item-img"></image>
                    <view class="item-text">{{item.text}}</view>
                </view>
            </view>
        </view>
        <view wx:if="{{business.changeMP === true}}" class="mask" @tap="bindHideMask"></view>
        <view wx:if="{{business.changeMP === true }}" class="mpBox">
            <view class="default">
                <view class="name logoPadding">{{business.miniProgramName}}</view>
                <view>默认</view>
                <image  class="haslogo" mode="{{aspectFit}}" src="{{business.selected.headImg ||'https://pic8.58cdn.com.cn/bizmp/n_v285d6a16d725a446694db35df23c9db24.png?w=375&h=375'}}"></image>
            </view>
            <view class="otherBox">
                <repeat for="{{business.mps}}" key="index" index="index" item="item">
                    <view class="mpbox">
                        <view bindtap="selectMp({{item}})" class="mpItem logoPadding" data-appid="{{item.id}}" :class="{ 'active' : item.id === business.chosedId}">{{item.nickName || item.id}}</view>
                        <image class="haslogo" mode="{{aspectFit}}" src="{{item.headImg ||'https://pic8.58cdn.com.cn/bizmp/n_v285d6a16d725a446694db35df23c9db24.png?w=375&h=375'}}"></image>
                    </view>
                </repeat>
            </view>
            <view class="btnBox">
                <view class="cancle" @tap="bindHideMask">取消</view>
                <view class="confirm" :class="{ 'active' : business.canConfirm}" bindtap="confirmAction">确定</view>
            </view>
        </view>
        <view wx:if="{{!isFollow && showModal}}">
            <view class="showModal_mask" bindtap="hideModal"></view>
            <view class="showModal_modal">
                <view class="showModal_title">提示</view>
                <view class="showModal_text">关注公众号接收订单通知</view>
                <view class="showModal_btns">
                    <button class="showModal_btn" bindtap="hideModal">取消</button>
                    <navigator class="showModal_btn red_text" wx:if="{{assistAuth}}" url="/pages/followPublic">马上关注</navigator>
                    <button class="showModal_btn red_text" wx:elif="{{!assistAuth}}" open-type="getUserInfo" @tap="loadSession()">马上关注</button>
                </view>
            </view>
        </view>
    </scroll-view>
</template>

<script>
import wepy from 'wepy';
import Mixin from '../mixin';

import { items, nItems } from '../utils/homeList';

import { alert } from '../utils';
import { post, get } from '../utils/ajax';
import { globalData } from '../utils/globalData';
import { getUid, SendClickLog } from '../utils/maidian';

import { CHAT_LOGIN } from '../utils/url';

import { sdkLogin, onMsgNotify } from '../utils/IM/IM';

export default class Home extends wepy.page {
    mixins = [Mixin]
    config = {
        navigationBarTitleText: '首页',
    }
    data = {
        code: '',
        iv: '',
        encryptedData: '',
        session: '',
        isFollow: false, // 是否关注公众号
        assistAuth: false, // 是否授权
        showModal: false, // 是否显示弹框
        height: '',
        business: {
            mps: [],
            name: '您的姓名',
            miniProgramName: '您还没购买小程序',
            unread: 0,
            mpCount: 0,
            progressText: '您还没有购买小程序',
            nexttask: 0,
            changeMP: false,
            canConfirm: false,
            selected: {
                id: 0,
            },
            chosedId: 0,
        },
        // 将状态属性收敛到status
        status: {
            loading: true,
            // 是否第一次进入小程序
            // 优化页面跳转体验
            first: true,
        },
        items,
        nItems,
        cardId: '1037641283830616064',
    }
    methods = {
        link(text) {
            // console.log(text);意见反馈不做判断
            if (text === '意见反馈') {
                wepy.navigateTo({
                    url: 'feedback',
                });
            } else if (text === '购买小程序') {
                // 购买小程序页面
                // wepy.navigateTo({
                //     url: 'purchase',
                // });
                this.buyMiniProgram();
            } else {
                this.checkBeforeJump(text);
            }
        },
        checkProgress () {
            SendClickLog('wxf03e52adc4b13448', getUid(), '{}', 'sjzh_home_buy_app');
            if (!this.business.mpCount) {
                alert('您还未购买小程序，请登录e.58.com进行购买', '提示');
                return;
            }
            console.log(this.business.nexttask);
            switch (this.business.nexttask) {
                case 2:
                    wepy.navigateTo({
                        url: 'AppEdit',
                    });
                    break;
                case 3:
                    wepy.navigateTo({
                        url: 'UploadInfo',
                    });
                    break;
                case 4:
                    if (this.business.selected.app_type === 2) {
                        wepy.setStorageSync('registMappid', this.business.selected.id);
                        wepy.navigateTo({
                            url: 'registMainAccount',
                        });
                    } else {
                        wepy.navigateTo({
                            url: 'progress',
                        });
                    }
                    break;
                case 5:
                    if (this.business.selected.app_type === 1) {
                        wepy.navigateTo({
                            url: 'progress',
                        });
                    } else {
                        wepy.navigateTo({
                            url: 'myMp',
                        });
                    }
                    break;
                case 6:
                    wepy.navigateTo({
                        url: 'progress',
                    });
                    break;
                case 7:
                    wepy.navigateTo({
                        url: 'progress',
                    });
                    break;
                case 8:
                    wepy.navigateTo({
                        url: 'progress',
                    });
                    break;
                case 9:
                    wepy.navigateTo({
                        url: 'progress',
                    });
                    break;
                default:
                    break;
            }
            this.$apply();
        },
        async changeAction () {
            SendClickLog('wxf03e52adc4b13448', getUid(), '{}', 'sjzh_home_switch_app');
            this.business = Object.assign({}, this.business, {
                changeMP: true,
            });
            const { data } = await post('/mplogic/mymplist');
            const { mpinfos } = data;
            this.business = Object.assign({}, this.business, {
                mps: mpinfos,
            });
            if (this.business.mps.length > 0) {
                const others = this.business.mps.filter((appinfo) => appinfo.id !==
                    this.business.selected.id);
                const formatedOther = others.map((item) => this.formatedMp(item));
                this.business = Object.assign({}, this.business, {
                    mps: formatedOther,
                    chosedId: 0,
                    canConfirm: false,
                });
                // this.business.mps.map((appinfo, index) => {
                //     if (appinfo.id === this.business.selected.id) {
                //         this.business.mps.splice(index, 1);
                //     }
                //     return '';
                // });
            }
            this.$apply();
        },
        bindHideMask () {
            this.business = Object.assign({}, this.business, {
                changeMP: false,
                canConfirm: false,
            });
            this.$apply();
        },
        selectMp (item) {
            this.business = Object.assign({}, this.business, {
                chosedId: item.id,
                canConfirm: true,
            });
            // console.log('点击', this.business);
            this.$apply();
        },
        // 切换小程序操作
        confirmAction () {
            if (this.business.selected.id) {
                this.setGlobalMpId(this.business.chosedId);
                this.loadData();
                this.loadExtJson();
                this.hideMask();
            }
        },
        hideModal() {
            this.showModal = false;
        },
    }
    async onLoad () {
        // globalData.extConfig和current_mpid只需要在load和切换小程序的时候重新设置，所以在load里边要调用loadData
        await this.loadData();
        this.setGlobalMpId(this.business.selected.id);
        this.loadExtJson();
        await this.getAssistAuth();
        if (!this.isFollow && wepy.getStorageSync('ppu')) {
            this.showModal = true;
            this.$apply();
        }
    }
    async onShow () {
        await this.loadData();
        await this.loadCode();
        await this.getInfo();
        // 聊天登录，监控未读消息
        const { isLoagin } = globalData.chat;
        if (!isLoagin) {
            this.chatLogin();
        }
    }
    formatedMp (item) {
        const mp = item;
        if (mp.headImg && mp.headImg.indexOf('http') === -1) {
            mp.headImg = `https://pic1.58cdn.com.cn${mp.headImg}`;
        }
        return mp;
    }
    /**
     * 用户点击右上角分享
     */
    onShareAppMessage (res) {
        if (res.from === 'button') {
            // 来自页面内转发按钮
        }
        return {
            title: '高效管理商家小程序的一站式服务工具',
            path: '/pages/home',
            imageUrl: 'https://static.58.com/lbg/shangjiaxcxht/zhushou/img/share.png',
            success (data) {
                console.log(data);
            },
            fail (err) {
                console.log(err);
            },
        };
    }
    async getAssistAuth() {
        const that = this;
        try {
            const { data } = await get('/wechat/bizAssistAuth/get');
            const { isFollow, assistInfo } = data;
            if (!isFollow && assistInfo === null) {
                // 既没有授权也没有关注公众号
                that.assistAuth = false;
                that.$apply();
            } else if (!isFollow && JSON.stringify(assistInfo) !== '{}') {
                // 已授权但没有关注公众号
                that.assistAuth = true;
                that.$apply();
            }
            that.isFollow = isFollow;
            that.$apply();
        } catch (e) {
            console.log(e);
        }
    }
    // 获取授权数据
    async loadSession() {
        try {
            const { data } = await get('/wechat/bizAssistAuth/session', { code: this.code });
            const { sessionKey } = data;
            const { state, msg } = await get('/wechat/bizAssistAuth/insert', { encryptedData: this.encryptedData, iv: this.iv, session: sessionKey });
            if (state === 100) {
                wx.navigateTo({
                    url: '/pages/followPublic',
                });
            }
            if (state === 0) {
                alert(msg);
            }
        } catch (e) {
            console.log(e);
        }
    }
    async loadCode() {
        wx.login({
            success: (res) => {
                if (res.code) {
                    this.code = res.code;
                    // 查看是否授权
                } else {
                    console.log('denglishiba');
                }
            },
        });
    }
    async getInfo() {
        const that = this;
        // 已经授权，可以调用getuseinfo获取头像昵称
        wx.getUserInfo({
            success: (res) => {
                console.log(res);
                const { iv, encryptedData } = res;
                that.iv = iv;
                that.encryptedData = encryptedData;
                that.$apply();
            },
        });
    }
    hideMask () {
        this.business = Object.assign({}, this.business, {
            changeMP: false,
            canConfirm: false,
        });
        this.$apply();
    }
    // 获取当前小程序的extjson
    async loadExtJson() {
        const url = '/mpBusinessRelease/getExtJson';
        const { data } = await get(url, { sceneKey: wx.getStorageSync('current_mpid') });
        globalData.extConfig = data;
    }
    async loadData () {
        this.status.loading = true;
        this.$apply();
        try {
            const subData = {
                mpid: wepy.getStorageSync('current_mpid') || '',
            };
            const { data } = await post('/mplogic/index', subData);
            const {
                username = '',
                mpinfo = {},
                unread = '',
                count = 0,
                nexttask = '',
                score,
            } = data;
            const formatedMpinfo = this.formatedMp(mpinfo);
            this.business = Object.assign({}, this.business, {
                name: username,
                miniProgramName: mpinfo.nickName || '您还没购买小程序',
                unread,
                mpCount: count,
                selected: {
                    ...formatedMpinfo,
                    score,
                },
            });
            this.status.loading = false;
            this.status.first = false;
            nexttask && this.setNextTask(nexttask);
            // console.log('this.business', this.business);
            this.$apply();
        } catch (e) {
            console.log('e', e);
        }
    }
    setGlobalMpId (id) {
        if (id) {
            wepy.setStorageSync('current_mpid', id);
        }
    }
    checkBeforeJump (text) {
        if (!this.business.mpCount) {
            alert('您还未购买小程序，请登录e.58.com进行购买', '提示');
            return;
        }
        switch (text) {
            case '我的小程序':
                wepy.navigateTo({
                    url: 'myMp',
                });
                break;
            case '订单管理':
                wepy.navigateTo({
                    url: 'OrderList',
                });
                break;
            case '收款记录':
                wepy.navigateTo({
                    url: 'paymentRecord',
                });
                break;
            case '支付开通':
                wepy.navigateTo({
                    url: 'OpenPay',
                });
                break;
            case '店铺装修':
                wepy.navigateTo({
                    url: 'templateList',
                });
                break;
            case '发布商品':
                wepy.navigateTo({
                    url: 'goodsComponentGroup',
                });
                break;
            case '发布服务':
                wepy.navigateTo({
                    url: 'orderComponentGroup',
                });
                break;
            case '优惠劵':
                wepy.navigateTo({
                    url: 'couponManage',
                });
                break;
            case '素材管理':
                wepy.navigateTo({
                    url: 'resourceManage',
                });
                break;
            case '购买小程序':
                // wepy.navigateTo({
                //     url: 'purchase',
                // });
                this.buyMiniProgram();
                break;
            case '注册小程序':
                if (this.business.selected.app_type === 1) {
                    alert('当前小程序为优享小程序，不用提交注册信息', '提示');
                    return;
                }
                if (this.business.selected.sign === 1) {
                    wepy.navigateTo({
                        url: 'registed',
                    });
                } else {
                    wepy.setStorageSync('registMappid', this.business.selected.id);
                    wepy.navigateTo({
                        url: 'registMainAccount',
                    });
                }
                break;
            case '进度查询':
                wepy.navigateTo({
                    url: 'progress',
                });
                break;
            case '意见反馈':
                wepy.navigateTo({
                    url: 'feedback',
                });
                break;
            case 6:
                wepy.navigateTo({
                    url: 'templateList',
                });
                break;
            default:
                break;
        }
    }
    setNextTask (taskNum) {
        this.business = Object.assign({}, this.business, {
            nexttask: taskNum,
        });
        switch (taskNum) {
            case 2:
                this.business.progressText = '当前小程序未添加小程序信息';
                break;
            case 3:
                this.business.progressText = '当前小程序还未上传素材';
                break;
            case 4:
                if (this.business.selected.app_type === 1) {
                    this.business.progressText = '当前小程序信息已完善';
                } else {
                    this.business.progressText = '当前小程序还未填写注册信息';
                }
                break;
            case 5: // 跳转我的小程序
                if (this.business.selected.app_type === 1) {
                    this.business.progressText = '当前小程序信息已完善';
                } else {
                    this.business.progressText = '当前小程序还未授权';
                }
                break;
            case 6: // 跳转到进度
                this.business.progressText = '当前小程序信息已完善';
                break;
            case 7: // 消息列表
                this.business.progressText = '当前小程序信息已完善';
                break;
            case 8: // 消息列表
                this.business.progressText = '当前小程序信息已完善';
                break;
            case 9: // 完成度
                this.business.progressText = '当前小程序信息已完善';
                break;
            default:
                break;
        }
        this.$apply();
    }

    // chatLogin 聊天登录
    async chatLogin() {
        try {
            const { cardId } = this.data;
            /**
                tim 包含 sdkAppID identifier userSig
                myInfo 包含 token nickName headImg
                unReadCount 未读消息数
            */
            const { data } = await get(CHAT_LOGIN, {
                channel: 1, // channel 身份 1是名片 2是用户
                userId: cardId, // userId 该身份对应的识别id，商家传cardId(名片Id)
            });

            const { tim, myInfo, unReadCount = 20 } = data;
            const { unReadCount: counts } = globalData.chat;
            const text = counts && counts > 0 ? (counts + Number(unReadCount)) : unReadCount;
            if (Number(text) && Number(text) > 0) {
                wx.setTabBarBadge({
                    index: 1,
                    text: text > 99 ? '99+' : text,
                });
            }
            const { token, nickName, headImg } = myInfo;
            // 设置全局token
            Object.assign(globalData.chat, {
                isLogin: true,
                token,
                nickName,
                headImg,
            });

            // IM 登录，获取实时消息
            this.initIM(tim);
        } catch (e) {
            console.log(e);
        }
    }

    initIM(tim) {
        console.log('initIM');
        // 当前用户身份
        const loginInfo = {
            accountType: 37611,
        };
        Object.assign(loginInfo, tim);
        console.log(loginInfo);
        // listeners
        const listeners = {
            onMsgNotify: onMsgNotify, // 监听新消息
        };
        sdkLogin(loginInfo, listeners, {});
    }
}
</script>

<style lang="scss">
page{
    overflow: auto !important;
}
view,
scroll-view {
    box-sizing: border-box;
}
.index-item{
    margin-top: 50rpx;
}
.home {
    width: 100%;
    background: #f6f6f6;
    .mask {
        width: 100%;
        height: 100%;
        position: absolute;
        background: rgba(0, 0, 0, 0.5);
        top: 0;
    }
    .mpBox {
        width: 540rpx;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate3d(-50%, -50%, 0);
        background: white;
        border-radius: 2rpx;
        .name {
            width: 400rpx;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }
        .haslogo {
            width: 54rpx;
            height: 54rpx;
            position: absolute;
            left: 20rpx;
            top: 30rpx;
            border-radius: 100rpx;
        }
        .logoPadding {
            padding-left: 45rpx;
        }
        .default {
            padding: 0 40rpx;
        }
        .default {
            position: relative;
            height: 113rpx;
            font-size: 28rpx;
            color: #bdbdbd;
            line-height: 113rpx;
            display: flex;
            justify-content: space-between;
        }
        .otherBox {
            font-size: 32rpx;
            color: #666666;
            overflow: scroll;
            max-height: 320rpx;
            .mpbox {
                position: relative;
                padding: 0 40rpx;
            }
            .mpItem {
                .logoPadding {
                    padding-left: 45rpx;
                }
                height: 113rpx;
                line-height: 113rpx;
                border-top: 1rpx solid #f6f6f6;
                padding-right: 80rpx;
                white-space: nowrap;
                text-overflow: ellipsis;
                overflow: hidden;
            }
            .active {
                background: url(https://static.58.com/lbg/shangjiaxcxht/zhushou/img/correct-home.png)
                    no-repeat right;
                background-size: 34.5rpx 34.5rpx;
                color: #4e88ff;
            }
        }
        .btnBox {
            display: flex;
            height: 113rpx;
            width: 100%;
            line-height: 113rpx;
            .active {
                color: #4e88ff !important;
            }
            view {
                flex: 1;
                background: white;
                text-align: center;
                border: 1rpx solid #f6f6f6;
            }
            .cancle {
                font-size: 34rpx;
                color: #666666;
            }
            .confirm {
                font-size: 34rpx;
                color: #bdbdbd;
            }
        }
    }
    .index-loaded-header {
        width: 100%;
        height: 562rpx;
        .welcome-block {
            width: 100%;
            height: 306rpx;
            background: url(https://static.58.com/lbg/shangjiaxcxht/zhushou/img/welcome-block.png)
                no-repeat;
            background-size: 100% auto;
            padding: 40rpx 40rpx 0 40rpx;
            position: relative;
            .welcome-title {
                font-size: 36rpx;
                color: #ffffff;
                letter-spacing: 0;
            }
            .msg-box {
                position: absolute;
                right: 40rpx;
                top: 50rpx;
                width: 41rpx;
                height: 31rpx;
                background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAAfCAYAAAB6Q+RGAAAAAXNSR0IArs4c6QAAAzpJREFUWAnNmMdP1GEQhhcwerDXgyC2owePYoktnowxGmOMsRy88Ccgij0GoxHFFhs2bAcvnvGgwRCMRqKRk11PerImiyD4DJmXfKy7vy2wsJO8mfm+aU8Wthb19PTMicVijagCFaNCsW5AWtHWIiCbCFYVClkSjiaDjJMY5clOfDX64ufhcCUsPYxKfXk8BqTsrwft+GnDQcfeEnTXOfpcCLmD27hnXuGnDiUo+wzwju83V684hJzO5WrU4cmX+ClDAcoeA7zte83tRKU694M0IBJrkEBfEE/OJyjzDfAWktlzwjhSQ3rBWor+eFcbflI+QJlbjG76HnO7tIc4GtJB11Eo0OfEEzVgMDzzDLARyXaHc7lMD+mg6ynu9CnP8BPCQbnGzDHAGz7XXE3iLO4yg3TQDTQI9CnxgEDpN8DrSLYnEdD3Zg7pDRuZ2OVTn+DHJxuc7o4+A7zmc8ztTdVDLjtIB91Eo0BbicelWpDsnnoDvIpk+5LV6Y6i7CGtmcbNSKAtxGM1NMpTZ2+/V5Bsf1S95SjMDdKbtzBAb6GPicdELSRvgA1IdiCqXjmKc4d00EPaiG9GozU89Nwb4GUkaw7zUTENuUPSvAB901b3j/D9QDkb4CXPh84+4aQ1GnKDpLECffeNn/FVSH/6h8S9L/j4kSj8E9dyDh/R2nSU1GcPSdNCFALOtUXcbUcC/Up8H71Dsl4gDvbIXtQl/kgUKPnsIGlYhH4gs0/IvnL0GWd7HU38F7C31Kq+IgLOBnoByY6G+TCmIHNIihcjAX4knh0OU8x9OapG9onmIJqvXOi5N9DzSHYszCsmmRkkhUvQT5/2AT9LQwbimWOg53yuueOJ87hLD0nRUiTA98SDAigY5hnoWSSrU848l9GQFCxDv5CZPQlmhgMGM2b2GVvidlKzOaeGJLkcCfAtcbka8+XZcQrJ6m0Ph+SQJFag315tgDPyBZY4l131vtfcaVSmsxHLthEI8A1xWeKgfJ/ZeUIw+HuKQ8guv3yN1xfzfHP9N5/ddYKTH0FVB7JfMOyXgy7UgFZSgBsWa2NrO5rn2+P2MtDEoZB/C3pgv6JVohbUjQrJjMe4Kv8BnZkdhMJllJAAAAAASUVORK5CYII=);
                background-size: 100% auto;
            }
            .msg-box.new-msg::after {
                width: 20rpx;
                height: 20rpx;
                background: red;
                border-radius: 50%;
                content: '';
                position: absolute;
                right: -9rpx;
                top: -8rpx;
            }
        }
        .item-detail {
            width: 698rpx;
            height: 448rpx;
            background: #fff;
            border-radius: 16rpx;
            margin: 0 26rpx;
            position: relative;
            top: -190rpx;
            padding: 30rpx;
            .haslogo {
                position: absolute;
                width: 83rpx;
                height: 83rpx;
                border-radius: 100rpx;
                top: 50rpx;
                left: 20rpx;
            }
            .logoPadding {
                padding-left: 90rpx;
            }
            .item-name {
                font-size: 32rpx;
                color: #333333;
                letter-spacing: 0;
                line-height: 65rpx;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 560rpx;
            }
            .item-title,
            .item-switch {
                font-size: 28rpx;
                color: #999999;
                letter-spacing: 0;
                line-height: 60rpx;
            }
            .item-switch {
                color: #4e88ff;
                position: absolute;
                right: 30rpx;
                top: 30rpx;
                &:before{
                    width:18rpx;
                    height:17rpx;
                    content: '';
                    background:url(https://static.58.com/lbg/shangjiaxcxht/zhushou/img/switch-icon.png) no-repeat;
                    background-size:18rpx 17rpx;
                    position:absolute;
                    left:-25rpx;
                    top:50%;
                    margin-top:-8rpx;
                }
            }
        }
        .item-detail-progress {
            width: 646rpx;
            height: 84rpx;
            line-height: 84rpx;
            background: #EDF3FF;
            border-radius: 100px;
            position: relative;
            padding-left:81rpx;
            &::after {
                display: block;
                position: absolute;
                right: 20rpx;
                top:50%;
                margin-top:-13rpx;
                content: '';
                width: 15rpx;
                height: 26rpx;
                background: url('https://static.58.com/lbg/shangjiaxcxht/zhushou/img/blue-right-angel.png')
                    no-repeat center;
                background-size: 100%;
            }
            .current-progress {
                width: 31rpx;
                height: 26rpx;
                background:url(https://static.58.com/lbg/shangjiaxcxht/zhushou/img/current-msg-icon.png) no-repeat;
                background-size:31rpx 26rpx;
                position:absolute;
                left:30rpx;
                top:50%;
                margin-top:-13rpx;
            }
        }
        .remind-title {
            font-family: PingFangSC-Regular;
            font-size: 26rpx;
            color: #6AA1FF;
        }
    }
    .follow-public {
        width: 100%;
        height: 80rpx;
        line-height:80rpx;
        position:relative;
        font-size: 28rpx;
        color: #FFA710;
        padding: 0 30rpx;
        background: #FFEDCF;
        .follow-action {
            color: #FFA710;
            text-align: center;
            line-height: 50rpx;
            font-size: 28rpx;
            height: 50rpx;
            border: 1rpx solid #FFA710;
            border-radius: 5rpx;
            position:absolute;
            right:30rpx;
            top:15rpx;
            background:#fff;
            padding:0 15rpx;
        }
    }
    .index-loaded-body {
        width: 698rpx;
        height: 430rpx;
        padding: 60rpx 30rpx;
        margin: 30rpx 26rpx;
        background: #fff;
        border-radius: 16rpx;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        .index-loaded-item {
            width: 156rpx;
            margin-bottom: 70rpx;
            text-align: center;
            .item-img {
                width: 72rpx;
                height: 72rpx;
            }
            .item-text {
                font-size: 26rpx;
                color: #333333;
                letter-spacing: 0;
                text-align: center;
                line-height: 32rpx;
                margin-top: 6rpx;
            }
        }
    }
    .index-block .index-loaded-item{
        margin-left:15rpx;
    }
    .index-block{
        width: 698rpx;
        background: #fff;
        border-radius: 16rpx;
        margin: 30rpx 26rpx;
        .index-block-title{
            height:72rpx;
            border-bottom:1rpx solid #f6f6f6;
            padding-left:30rpx;
            line-height:72rpx;
            box-sizing:border-box;
            font-family: PingFangSC-Medium;
            font-size: 28rpx;
            color: #333333;
        }
    }

    .index-block-body{
        display:flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        padding-bottom: 30rpx;
        .index-loaded-item {
            width: 156rpx;
            text-align: center;
            &.new-margin{
                margin:30rpx 0 0rpx 15rpx;
            }
            .item-img {
                width: 72rpx;
                height: 72rpx;
            }
            .item-text {
                font-size: 26rpx;
                color: #333333;
                letter-spacing: 0;
                text-align: center;
                line-height: 32rpx;
                margin-top: 6rpx;
            }
        }
        .shangxin.index-loaded-item{
            position:relative;
            &:before{
                content: '上新';
                width: 52rpx;
                height:30rpx;
                background:url(https://static.58.com/lbg/shangjiaxcxht/zhushou/img/shangxin.png) no-repeat;
                background-size:52rpx 30rpx;
                position:absolute;
                top:-10rpx;
                right:15rpx;
                font-family: PingFangSC-Regular;
                font-size: 20rpx;
                color: #FFFFFF;
            }
        }
    }
}

.star-box {
    position: relative;
    display: flex;
    margin-top: 16rpx;
}

.star-box-title {
    font-size: 24rpx;
    color: #999;
    margin-left: 12rpx;
    line-height: 24rpx;

    &::after {
        display: inline-block;
        width: 12rpx;
        height: 20rpx;
        content:'';
        background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAaBAMAAACa4xtRAAAAJFBMVEUAAACcnJyZmZmampqampqdnZ2ZmZmcnJyZmZmZmZmZmZmZmZn2rJLyAAAAC3RSTlMAOvOzgyfnGw/iltkIdIcAAAA8SURBVAjXY2AXYICAps1QRvVuAwiDZTdMyJuKQqt3Q2xkzd7UAGaE7VaECQiQK8AJFWCIhgowsBgyoAIAfN4dpEaw3mAAAAAASUVORK5CYII=') no-repeat;
        background-size: 12rpx 20rpx;
        margin-left: 8rpx;
        line-height: 24rpx;
    }
}

.unstar-list {
    display: flex;
    .icon-unstar {
        flex: none;
        margin-right: 8rpx;
        width: 22rpx;
        height: 22rpx;
        background: url('/unstar.png') no-repeat;
        background-size: 22rpx 22rpx;
    }
}
.star-list {
    position: absolute;
    top: 0;
    left: 0;
    overflow: hidden;
    display: flex;
    .icon-star {
        flex: none;
        margin-right: 8rpx;
        width: 22rpx;
        height: 22rpx;
        background: url('/star.png') no-repeat;
        background-size: 22rpx 22rpx;
    }
}
.showModal_mask{
    width:100%;
    height:100%;
    background:rgba(0,0,0,.5);
    position:fixed;
    top:0;
    bottom:0;
    z-index:1;    
 }
 .showModal_modal{
     width:540rpx;
     background:white;
     z-index:2;
     position:fixed;
     top:50%;
     left:50%;
     transform:translate3d(-50%,-50%,0);
     text-align:center;    
 }
 .showModal_title{
     font-size: 36rpx;
     color: #333333;
     line-height: 36rpx;
     margin: 60rpx 0 30rpx 0;
 }
 .showModal_text{
     font-size: 28rpx;
     color: #666666;
     padding: 0 62rpx;
     text-align: center;
     margin-bottom: 48rpx;
 }
 .showModal_btns{
     display: flex;
     border-top: 1rpx solid #F3F3F3;
     height: 86rpx;
    line-height: 86rpx;
 }
 .showModal_btn{
     flex: 1;
     background: white;
     padding: 0;
     border: none;
     border-radius: 0;
     font-size: 34rpx;
     color:#333;
 }
 .showModal_btn::after{
     display: none;
 }
 .red_text{
    color:#6AA1FF;
     border-left: 1rpx solid #F3F3F3;
 }
</style>