"use strict";!function(){var a={toArray:function(a){return Array.prototype.slice.call(a)},range:function(){var a=window.getSelection()&&window.getSelection();return a&&a.rangeCount>0?a.getRangeAt(0):void 0},resetRange:function(a,b,c,d){var f,e=window.getSelection();e.removeAllRanges(),f=document.createRange(),f.setStart(a,b),f.setEnd(c||a,d||b),e.addRange(f)},focusDom:function(){if(a.range()){var b=a.range().endContainer;return 3===b.nodeType?b.parentNode:b}},createNode:function(a,b){var d,c=document.createElement(a);for(d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}},b=function i(b){var c="string"==typeof b?document.querySelector(b):b;return{dom:c,html:function(a){return a?(c.innerHTML=a,this):c.innerHTML},parseHTML:function(a){var b=document.createRange(),c=b.createContextualFragment.bind(b);return c(a)},parent:function(){return i(c.parentNode)},children:function(b){return a.toArray(c.childNodes).filter(function(a){return a.matches&&a.matches(b)})},prepend:function(a){return"string"==typeof a?c.insertAdjacentHTML("afterbegin",a):c.insertBefore(a,c.firstChild),this},append:function(a){return"string"==typeof a?c.insertAdjacentHTML("beforeend",a):c.appendChild(a),this},before:function(a){return"string"==typeof a?c.insertAdjacentHTML("beforebegin",a):c.parentNode&&c.parentNode.insertBefore(a,c),this},after:function(a){return"string"==typeof a?c.insertAdjacentHTML("afterend",a):c.parentNode&&c.parentNode.insertBefore(a,c.nextSibling),this},classes:function(){return c.classList},hasClass:function(a){return c.classList?c.classList.contains(a):!1},addClass:function(a){return c.classList?c.classList.add(a):c.className=a,this},removeClass:function(a){return c.classList&&c.classList.remove(a),this},css:function(a){var b,d,e;if("string"==typeof a)return b=el.ownerDocument.defaultView,b.getComputedStyle(c,null);d=function(b){var d=a[b];["left","right","top","bottom","width","height"].forEach(function(a){~b.indexOf(a)&&"number"==typeof d&&(d+="px")}),c&&(c.style[b]=d)};for(e in a)d(e);return this},hide:function(){return this.css({display:"none"})},on:function(a,b){return c?(c.addEventListener(a,b),this):void 0},appendFromParent:function(a){a?c.innerHTML="":a="<p><br/></p>",c.insertAdjacentHTML("beforeend",a)},isEmpty:function(){return""===c.innerHTML||void 0===c.innerHTML},wrap:function(a){return i(this.parent()).prepend(a),this.parent().firstChild.appendChild(this.dom),this},focus:function(){return c.focus(),this},closest:function(a){for(var b=this.dom,c=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector;b;){if(c.call(b,a))return b;b=b.parentElement}return null}}},c=function(c,d){function l(c){function l(a){for(var b=[];a;){if(b.push(a),"HTML"===a.tagName)return b.push(document),b.push(window),b;a=a.parentElement}}var g,i,k,d=b(".zeditor-content p:last-child");d=b(h),a.focusDom()==e,window.$p=b(a.focusDom()),g=c.target.dataset.type,i=c.path||c.composedPath&&c.composedPath()||l(c.target),k=b(i[0]).hasClass("active"),"fontweight"===g&&d.css({"font-weight":"800"}),"fontweight"!==g||k||d.css({"font-weight":"normal"}),"image"===g&&f.selectImage&&f.selectImage(function(a){var c=window.$p;c&&c.parent().dom?b("#mainWapper").append('<p><img src="'+a+'" style="width:100%" /></p>'):j.append('<p><img src="'+a+'" /></p>')}),j.focus()}var g,h,i,j,k,m,n,o,p,q,r,e="<p><br/></p>",f={content:e};for(g in d)f[g]=d[g];return h=void 0,i=f.content,b(c)&&b(c).dom?(b(c).addClass("zeditor-container").html('\n            <div class="zeditor-content" id="mainWapper" contenteditable="true" ></div>\n            <div id="mainTest"  class="zeditor-btn-main">\n                <a href="javascript:void(0)" class="zeditor-btn-li iconfont icon-zuoduiqi font-style _font-style" data-type="fontweight" /></a>\n                <img src="//static.58.com/lbg/shangjiaxcxht/zhushou/img/upload-icon.png" class="icon-tupian"/>\n                <input type="file" class="icon-tupian icon-tupian-btn" accept="image/*"  data-type="image">\n            </div>\n        '),j=b(".zeditor-content"),j.focus(),b("#mainTest").on("touchend",l),k=function(){},m=function(c){var g,h,i,j,k,l,m,d=void 0,e=0,f=c.split(/\n/).filter(function(a){return!!a});0!==f.length&&(g=a.focusDom(),b(g).children("img").length>0&&(b(g).after("<p></p>"),g=g.nextSibling),h=a.range(),i=h.startOffset,j=h.endOffset,k=b(g).html().replace(/&nbsp;/g," "),l=k.substring(0,i)+f[0]+k.substring(j),b(g).html(l.replace(/\s/g,"&nbsp;")),d=g.firstChild,e=Math.min(i+f[0].length,g.firstChild.length),f.length>1&&(m=g.nextSibling,b(g).after("<p>"+f.slice(1).join("</p><p>").replace(/\s/g,"&nbsp;")+"</p>"),d=m?m.previousSibling.firstChild:g.parentNode.lastChild.firstChild,e=f[f.length-1].length),a.resetRange(d,e))},n=function(a){var b,c,d,f,e,g;if(a.clipboardData&&a.clipboardData.items){b=!0,c=!1,d=void 0;try{for(e=a.clipboardData.items[Symbol.iterator]();!(b=(f=e.next()).done);b=!0)g=f.value,"text/plain"===g.type&&g.getAsString(m),"text/html"===g.type&&g.getAsString(function(a){var b=a.match(/<p[^\<\>]*?><img\s[^\<\>]*?src=\"([^\<\>]*?)\"\s?[^\<\>]*?\/?><\/p>/);b&&2===b.length&&console.log(b[1])})}catch(h){c=!0,d=h}finally{try{!b&&e.return&&e.return()}finally{if(c)throw d}}a.preventDefault()}},o=function(){var c=a.focusDom();j.dom.getBoundingClientRect(),c.getBoundingClientRect()},p=function(a){8===a.keyCode&&j.isEmpty(),k()},q=function(b){b.stopPropagation(),h=a.focusDom()},r=function(){j.append(i).on("paste",n).on("mouseup",o).on("keyup",p).on("blur",q),document.addEventListener("click",function(a){b(a.target).closest(".zeditor-container")||k()})},r(),{getHtml:function(){return j.html()},appendFromParent:function(a){return j.appendFromParent(a)}}):(console.error("节点配置不正确。"),void 0)};window.ZEditor=c}();