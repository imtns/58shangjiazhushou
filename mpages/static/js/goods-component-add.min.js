/*eslint-disable */
"use strict";var $errorPop=$("div.tips-error"),skuRemoved=[],Page={ppu:"",id:"",mpId:"",group:"",name:"",saveStatus:"",test:"",pop:function(a){var b="none",c=$("div.mask,div._dialog"),d=$("._dialog p.dialog-content");d.text(a),c.removeClass(b)},toast:function(a,b){var e,f,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1,d=void 0;d=c?$("div.win2"):$("div.mask,div.win2"),e="none",f=$("div.tips2"),f.addClass(e),d.removeClass(e),b&&$(".error-infor").html(b),a.removeClass(e),setTimeout(function(){d.addClass(e),f.addClass(e)},2e3)},getKey:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):null},init:function(){Page.ppu=decodeURIComponent(Page.getKey("ppu")),Page.id=Page.getKey("id"),Page.group=Page.getKey("group"),Page.mpId=Page.getKey("mpId"),Page.test="",$(".item-file-div").removeClass("none"),Page.id&&"undefined"!=Page.id&&(document.title="商品编辑",Page.loadGoodData()),Page.getGroup()},initEvent:function(){window.editor=ZEditor("#editor",{selectImage:function(a){$(".icon-tupian-btn").on("change",function(){var f,g,b="none",c=$("div.mask,div.win2"),d=$("div.tips2"),e=$(".tips-submiting");$(".tips-submiting p").text("上传中"),d.addClass(b),c.removeClass(b),e.removeClass(b),f=this,g=new FormData,g.append("source",$(f).get(0).files[0]),document.domain="58.com",$.ajax({url:"https://yaofa.58.com/picRotateUpload",type:"POST",data:g,contentType:!1,processData:!1,success:function(d){var f;d=JSON.parse(d),c.addClass(b),e.addClass(b),100==d.state?(f="//pic1.58cdn.com.cn"+d.data.source,a(f+"?w=750"),$(".icon-tupian-btn").replaceWith('<input type="file" accept="image/*" class="icon-tupian icon-tupian-btn" data-type="image">')):Page.toast($errorPop,d.msg)},error:function(a){c.addClass(b),e.addClass(b),Page.toast($errorPop,a)}})})}}),$("#pName").on("keyup",function(a){a.target.value.length>=15&&(a.target.value=a.target.value.substr(0,15))}),$(".icon-bold").on("click",function(){$(this).attr("src").indexOf("unbold")>1?($(this).attr("src","//static.58.com/lbg/shangjiaxcxht/zhushou/img/bold.png"),$(".zeditor-content").css("font-weight","bold"),$(".zeditor-content").find("p").css("font-weight","bold")):($(this).attr("src","//static.58.com/lbg/shangjiaxcxht/zhushou/img/unbold.png"),$(".zeditor-content").find("p").css("font-weight","normal"))}),$("input[type=radio][name=size]").on("change",function(){"single"==$(this).val()?($(".item-flex-s").hide(),$(".item-price").show()):($(".item-flex-s").show(),$(".item-price").hide())}),$(".add-size").on("click",function(){if($(".size-info-wrapper").length>9)return Page.toast($errorPop,"规格最多添加10个"),void 0;var a='<div class="size-info-wrapper"><div class="size-info"><div class="info-line"><span>名称</span><input type="text" class="size-name" value="" placeholder="例/大份"></div><div class="info-line"><span>价格</span><input type="number" class="size-price" value="" placeholder="请输入"><span></span></div><div class="info-line"><span>库存</span><input type="number" class="size-stock" value="" placeholder="请输入"><span></span></div></div><div class="delete"></div></div>';$(a).insertBefore($(this)),$(".size-info-wrapper .delete").on("click",function(){$(this).parent().remove()})}),$("#item-file-btn").on("change",function(){var a=this,b=new FormData,c="none",d=$("div.mask,div.win2"),e=$("div.tips2"),f=$(".tips-submiting");$(".tips-submiting p").text("上传中"),e.addClass(c),d.removeClass(c),f.removeClass(c),b.append("sources",$(a).get(0).files[0]),$.ajax({url:"https://yaofa.58.com/picRotateUpload",type:"POST",data:b,contentType:!1,processData:!1,success:function(a){var b;a=JSON.parse(a),b=a.data.sources,d.addClass(c),f.addClass(c),b?($("#cover").attr("src","https://pic1.58cdn.com.cn"+b),$(".item-upload-img").removeClass("none"),$(".item-file-div").addClass("none")):Page.toast($errorPop,a.msg)},error:function(a){d.addClass(c),f.addClass(c),Page.toast($errorPop,a)}})}),$(".exchange-img").on("click",function(){$(".item-upload-img").attr("src","").addClass("none"),$(".item-file-div").removeClass("none")}),$(".save-btn").on("click",function(){var k,l,m,a=Page.group,b=$("._title").val().trim(),c=$(".zeditor-content").html(),d=$("._source").val()||0,e=$(".item-input._author").val()||0,f=$(".zeditor-content").find("p"),g=$(".zeditor-content").html(),h=$("#cover").attr("src")?$("#cover").attr("src").split(".cn")[1].replace(/([\/])\1+/g,"$1"):"",i=[],j=1;return Number(e)>999999?(Page.toast($errorPop,"商品价格不能大于99999"),void 0):Number(d)>999999?(Page.toast($errorPop,"商品库存不能大于99999"),void 0):b?"multi"==$("input[name=size]:checked").val()&&$(".size-info-wrapper").length<1?(Page.toast($errorPop,"请添加规格"),void 0):h?Page.group&&"undefined"!=Page.group?1==f.length&&"<br>"==f.html()?(Page.toast($errorPop,"请编辑商品内容"),void 0):b.length>15?(Page.toast($errorPop,"商品标题不能多于15个字"),void 0):g.length>=2e4?(Page.toast($errorPop,"商品内容不得大于20000个字符"),void 0):(k=!1,$(".size-info-wrapper").forEach(function(a){(""==$(a).find(".size-price").val()||""==$(a).find(".size-name").val()||""==$(a).find(".size-stock").val())&&(k=!0)}),k?(Page.toast($errorPop,"库存内容不能为空"),void 0):("multi"==$("input[name=size]:checked").val()?(j=2,$(".size-info-wrapper").forEach(function(a){var b={id:$(a).attr("id"),price:$(a).find(".size-price").val(),skuName:$(a).find(".size-name").val(),stock:$(a).find(".size-stock").val()};i.push(b),skuRemoved.forEach(function(a){$.ajax({url:"/goods/sku/del",type:"POST",data:{id:a},headers:{"content-type":"application/x-www-form-urlencoded;charset=utf-8",PPU:Page.ppu||"wanghongyue",reqfrom:"biz_assistant"},success:function(a){console.log(a)}})})})):i=null,l="",l=Page.id&&"undefined"!=Page.id?"/goods/modify":"/goods/insert",m={groupId:a,title:b,pics:"http://pic1.58cdn.com.cn/"+h,stock:d||"未知",price:e||"0",description:c,test:Page.test||"",mpId:Page.mpId,skuType:j},console.log(m),Page.id&&"undefined"!=Page.id&&Object.assign(m,{goodId:Page.id}),"multi"==$("input[name=size]:checked").val()&&Object.assign(m,{skuParams:JSON.stringify(i)}),$.ajax({url:l,type:"POST",data:m,headers:{"content-type":"application/x-www-form-urlencoded;charset=utf-8",PPU:Page.ppu||"wanghongyue",reqfrom:"biz_assistant"},success:function(a){var a=JSON.parse(a);100==a.state?(Page.toast($("div.tips-success")),setTimeout(function(){wx.miniProgram.navigateBack({delta:1})},2e3)):Page.toast($errorPop,a.msg)}}),void 0)):(Page.toast($errorPop,"请选择所属分组"),void 0):(Page.toast($errorPop,"请上传商品头图"),void 0):(Page.toast($errorPop,"请填写商品标题"),void 0)}),$("._sure-create").on("click",function(){var a=$(".dialog-content-input").val();return a?a.length>15?(Page.toast($errorPop,"分组名称不得超过15个字！",!0),void 0):($.ajax({url:"/goods/addGroup",data:{name:a,test:Page.test,mpId:Page.mpId},headers:{"content-type":"application/x-www-form-urlencoded;charset=utf-8",PPU:Page.ppu||"wanghongyue",reqfrom:"biz_assistant"},success:function(a){var a=JSON.parse(a);100==a.state?($(".mask,.group-dialog").removeClass("none"),Page.getGroup()):Page.toast($errorPop,a.msg)}}),$(".mask,.dialog-create-group").addClass("none"),$(".dialog-content-input").val(""),void 0):(Page.toast($errorPop,"请输入分组名称！",!0),void 0)}),$("._cancel-btn").on("click",function(){$(".mask,._dialog,.dialog-create-group").addClass("none"),$(".dialog-content-input").val("")}),$(".item-chose").on("click",function(){$(".mask,.group-dialog").removeClass("none")}),$("._create-btn").on("click",function(){var a=$(".group-dialog-list").find(".group-dialog-item").length;return a>=10?(Page.toast($errorPop,"分组数量达到最大（10个），无法创建更多。"),void 0):($(".group-dialog").addClass("none"),$(".dialog-create-group").removeClass("none"),void 0)}),$(".group-dialog-list").attr("cursor","pointer").on("touchstart",".group-dialog-item",function(){var b,c,a=$(this).hasClass("selected");a?$(this).removeClass("selected"):(b=$(this).data("name"),c=$(this).data("id"),Page.group=c,$(this).addClass("selected").siblings(".group-dialog-item").removeClass("selected"),$("._chose-btn").data("name",b).data("group",c))}),$("._chose-btn").on("click",function(){var a=$(this).data("name"),b=$(this).data("group");return a?($(".item-chose").text(a),Page.name=a,Page.group=b,$(".mask,.group-dialog").addClass("none"),$(this).data(a,""),$(this).data(b,""),void 0):(Page.toast($errorPop,"请选择商品分组！"),void 0)})},getGroup:function(){$.ajax({url:"/goods/groups/specail",data:{mpId:Page.mpId,test:Page.test},headers:{"content-type":"application/x-www-form-urlencoded;charset=utf-8",PPU:Page.ppu||"wanghongyue",reqfrom:"biz_assistant"},success:function(a){var b,c,d;if(a=JSON.parse(a),console.log(a),$(".group-dialog-list").html(""),100==a.state){for(b=a.data,c="",d=0;d<b.length;d++)Page.group&&Page.group==b[d].data.id&&$(".item-chose").text(b[d].data.name),c+='<div class="group-dialog-item" data-id="'+b[d].data.id+'" data-name="'+b[d].data.name+'">'+b[d].data.name+"</div>";$(".group-dialog-list").html(c)}else Page.toast($errorPop,a.msg)}})},sizeWrap:function(a){var b="";a.forEach(function(a){b+='<div class="size-info-wrapper" id="'+a.id+'">'+'<div class="size-info">'+'<div class="info-line">'+"<span>名称</span>"+'<input type="text" class="size-name" value="'+a.skuName+'">'+"</div>"+'<div class="info-line">'+"<span>价格</span>"+'<input type="number" class="size-price" value="'+a.price+'">'+"</div>"+'<div class="info-line">'+"<span>库存</span>"+'<input type="number" class="size-stock" value="'+a.stock+'">'+"</div>"+"</div>"+'<div class="delete"></div>'+"</div>"}),$(b).insertAfter($("#size-text")),$(".size-info-wrapper .delete").on("click",function(){console.log($(this).parent().attr("id")),skuRemoved.push($(this).parent().attr("id")),$(this).parent().remove()})},loadGoodData:function(){$.ajax({url:"/goods/get",data:{goodId:Page.id,test:Page.test},headers:{"content-type":"application/x-www-form-urlencoded;charset=utf-8",PPU:Page.ppu||"wanghongyue",reqfrom:"biz_assistant"},success:function(a){var a=JSON.parse(a);console.log(a),$(".group-dialog-list").html(""),a.data.sku&&a.data.sku.length>0&&1==a.data.skuHave?(Page.sizeWrap(a.data.sku),$("#radio-1").attr("checked","checked"),$(".item-flex-s").show(),$(".item-price").hide()):($("#radio-2").attr("checked","checked"),$(".item-flex-s").hide(),$(".item-price").show()),100==a.state?($("._title").val(a.data.title),window.editor.appendFromParent(a.data.description),$("._source").val(a.data.stock),a.data.description.indexOf("bold")>-1&&$(".icon-bold").attr("src","//static.58.com/lbg/shangjiaxcxht/zhushou/img/bold.png"),$(".item-input._author").val(a.data.price),$("#cover").attr("src",a.data.pics),$(".item-upload-img").removeClass("none"),$(".item-file-div").addClass("none")):Page.toast($errorPop,a.msg)}})}};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a){var c,d,e,f;if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(c=Object(a),d=1;d<arguments.length;d++)if(e=arguments[d],null!=e)for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f]);return c},writable:!0,configurable:!0}),Page.init(),Page.initEvent();