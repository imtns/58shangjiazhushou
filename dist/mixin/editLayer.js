"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,a){function r(i,n){try{var s=t[i](n),o=s.value}catch(e){return void a(e)}if(!s.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var _modulesParse=require("./../utils/modulesParse.js"),_modulesParse2=_interopRequireDefault(_modulesParse),_utils=require("./../utils/index.js"),app=require("./../utils/globalData.js"),_require=require("./../utils/ajax.js"),post=_require.post;module.exports={showEdit:function(e){var t=e.currentTarget.dataset.name;this.data.isEditing&&!this.data.editLayer[t]&&(this.setData({editLayer:{}}),this.setData(_defineProperty({},"editLayer."+t,!this.data.editLayer[t])))},cancelClick:function(){this.setData({editLayer:{},isEditing:!1})},editClick:function(){if(this.setData({isEditing:!this.data.isEditing}),this.data.isEditing){console.log("编辑"),console.log(this.data.page_data);var e=this.data.page_data[0].id;this.data.page_data.length>0&&this.setData(_defineProperty({},"editLayer."+e,!0))}else this.setData({editLayer:{}}),this.goSave(),console.log("保存")},goSave:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=app.globalData.pageList.filter(function(e){return"index"===e.pageKey})[0].id,a=app.globalData.modules.map(function(e){var a=e.id,r=e.name,i=e.cfg,n=e.params;return Array.isArray(n)&&(n={}),{id:a,name:r,cfg:i,params:n,page_id:t}}),a=JSON.parse(JSON.stringify(a)),r=[],a.forEach(function(e){"coupon"===e.name&&e.params&&!e.params.couponIds&&((0,_utils.toast)("请补全组件中的优惠券。"),r.push(e))}),!(r.length&&r.length>0)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,post("/business/templete/savemodules",{businessPageId:t,modulesJson:JSON.stringify(_modulesParse2.default.save(a)),releaseId:app.globalData.extConfig.extJson.ext.releaseId,mpId:app.globalData.extConfig.extJson.ext.mpId});case 9:(0,_utils.toast)("保存成功");case 10:case"end":return e.stop()}},e,this)}));return e}(),goEdit:function(e){var t=e.currentTarget.dataset,a=t.id,r=t.name;wx.navigateTo({url:"../edit/"+r+"?id="+a})}};