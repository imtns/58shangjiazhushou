'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _index = require('./../../../utils/index.js');

var _getRoute = require('./../../../utils/getRoute.js');

var _getPage = require('./../../../utils/getPage.js');

var _getPage2 = _interopRequireDefault(_getPage);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ENUM_THEME = ['zero', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight']; /*eslint-disable */

var CLIP_SIZE = ['?w=690&h=690', '?w=690&h=510', '?w=336&h=252', '?w=220&h=164', [['?w=363&h=482', '?w=309&h=231', '?w=309&h=231'], ['?w=388&h=514', '?w=284&h=214', '?w=284&h=214']], ['?w=690&h=388', '?w=336&h=252', '?w=336&h=252'], ['?w=690&h=388', '?w=218&h=164', '?w=218&h=164'], ['?w=160&h=160'], ['?w=336&h=448']];

exports.default = {
    imagesViewState: function imagesViewState() {
        var modules = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

        for (var i = 0, len = modules.length; i < len; i++) {
            var name = modules[i].name;

            if (name === 'images') {
                var setting = modules[i].props.cfg;
                if (setting.theme === undefined) setting.theme = '2';
                this.imagesConfState(setting);
                this.imageState(setting);
            }
        }
    },
    imagesConfState: function imagesConfState(setting) {
        var theme = setting.theme,
            _setting$hasMore = setting.hasMore,
            hasMore = _setting$hasMore === undefined ? true : _setting$hasMore,
            images = setting.images;

        var viewState = {
            styleName: '',
            maxNum: 0,
            showMore: !0
        };
        switch (theme) {
            case '1':
            case '2':
            case '3':
                viewState.styleName = ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > theme * 2;
                viewState.maxNum = viewState.showMore ? theme * 2 : images.length;
                break;
            /* 1左2右 */
            case '4':
                // 转主题小标到样式名称
                viewState.styleName = images[0].title ? ENUM_THEME[theme] + 'plus' : ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > 3;
                viewState.maxNum = viewState.showMore ? 3 : images.length;
                break;
            /* 1上2下 */
            case '5':
                viewState.styleName = ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > 3;
                viewState.maxNum = viewState.showMore ? 3 : images.length;
                break;
            /* 1上3下 */
            case '6':
                viewState.styleName = ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > 4;
                viewState.maxNum = viewState.showMore ? 4 : images.length;
                break;
            /* 1行4张 */
            case '7':
                viewState.styleName = ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > 4;
                viewState.maxNum = viewState.showMore ? 4 : images.length;
                break;
            /* 双图 */
            case '8':
                viewState.styleName = ENUM_THEME[theme];
                viewState.showMore = hasMore && images.length > 2;
                viewState.maxNum = viewState.showMore ? 2 : images.length;
                break;
        }
        Object.assign(setting, viewState);
    },
    imageState: function imageState(_ref) {
        var images = _ref.images,
            theme = _ref.theme,
            styleName = _ref.styleName;

        for (var i = 0, len = images.length; i < len; i++) {
            var viewState = {
                src: images[i].src,
                itemClass: '',
                itemIndex: 0
            };
            var index = ~i % 3 === 0 ? 3 : -(~i % 3);
            switch (theme) {
                case '1':
                case '2':
                case '3':
                    viewState.src += CLIP_SIZE[theme];
                    viewState.itemClass = ~i % theme === 0 ? 'mod-li-box-' + theme + ' mod-li-box-last' : 'mod-li-box-' + theme;
                    break;
                /* 1左2右 */
                case '4':
                    viewState.src += CLIP_SIZE[4][styleName.indexOf('plus') > -1 ? 1 : 0][index - 1];
                    viewState.itemIndex = index;
                    viewState.itemClass = index > 1 ? 'mod-li-box-' + styleName + '-' + index + ' mod-li-box-last' : 'mod-li-box-' + styleName + '-' + index;
                    break;
                /* 1上2下 */
                case '5':
                    viewState.itemIndex = index;
                    viewState.src += CLIP_SIZE[theme][index - 1];
                    viewState.itemClass = index > 2 ? 'mod-li-box-' + styleName + '-' + index + ' mod-li-box-last' : 'mod-li-box-' + styleName + '-' + index;
                    break;
                /* 1上3下 */
                case '6':
                    index = ~i % 4 === 0 ? 4 : -(~i % 4);
                    viewState.src += CLIP_SIZE[theme][index - 1];
                    viewState.itemIndex = index;
                    viewState.itemClass = index > 3 ? 'mod-li-box-' + styleName + '-' + index + ' mod-li-box-last' : 'mod-li-box-' + styleName + '-' + index;
                    break;
                /* 1行4张 */
                case '7':
                    viewState.src += CLIP_SIZE[theme];
                    viewState.itemClass = ~i % 4 === 0 ? 'mod-li-box-' + theme + ' mod-li-box-last' : 'mod-li-box-' + theme;
                    break;
                /* 双图 */
                case '8':
                    viewState.src += CLIP_SIZE[theme];
                    viewState.itemClass = ~i % 2 === 0 ? 'mod-li-box-' + theme + ' mod-li-box-last' : 'mod-li-box-' + theme;
                    break;
            }
            Object.assign(images[i], viewState);
        }
    },
    onImageClick: function onImageClick(e) {
        var _e$currentTarget$data = e.currentTarget.dataset,
            index = _e$currentTarget$data.index,
            current = _e$currentTarget$data.current,
            pagekey = _e$currentTarget$data.pagekey;


        if (pagekey && pagekey !== '') {
            var route = (0, _getRoute.getRoute)(pagekey);
            var _pagekey = (0, _getPage2.default)(this.route);
            if (_pagekey === pagekey) return;
            (0, _getRoute.navigateTo)(route);
        } else {
            var images = this.data.page_data[current].props.cfg.images.map(function (img) {
                return img.src;
            });
            (0, _index.previewImage)(images, index);
        }
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdlcy5qcyJdLCJuYW1lcyI6WyJFTlVNX1RIRU1FIiwiQ0xJUF9TSVpFIiwiaW1hZ2VzVmlld1N0YXRlIiwibW9kdWxlcyIsImkiLCJsZW4iLCJsZW5ndGgiLCJuYW1lIiwic2V0dGluZyIsInByb3BzIiwiY2ZnIiwidGhlbWUiLCJ1bmRlZmluZWQiLCJpbWFnZXNDb25mU3RhdGUiLCJpbWFnZVN0YXRlIiwiaGFzTW9yZSIsImltYWdlcyIsInZpZXdTdGF0ZSIsInN0eWxlTmFtZSIsIm1heE51bSIsInNob3dNb3JlIiwidGl0bGUiLCJPYmplY3QiLCJhc3NpZ24iLCJzcmMiLCJpdGVtQ2xhc3MiLCJpdGVtSW5kZXgiLCJpbmRleCIsImluZGV4T2YiLCJvbkltYWdlQ2xpY2siLCJlIiwiY3VycmVudFRhcmdldCIsImRhdGFzZXQiLCJjdXJyZW50IiwicGFnZWtleSIsInJvdXRlIiwiX3BhZ2VrZXkiLCJkYXRhIiwicGFnZV9kYXRhIiwibWFwIiwiaW1nIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsYUFBYSxDQUFDLE1BQUQsRUFBUyxLQUFULEVBQWdCLEtBQWhCLEVBQXVCLE9BQXZCLEVBQWdDLE1BQWhDLEVBQXdDLE1BQXhDLEVBQWdELEtBQWhELEVBQXVELE9BQXZELEVBQWdFLE9BQWhFLENBQW5CLEMsQ0FMQTs7QUFNQSxJQUFNQyxZQUFZLENBQ2QsY0FEYyxFQUVkLGNBRmMsRUFHZCxjQUhjLEVBSWQsY0FKYyxFQUtkLENBQUMsQ0FBQyxjQUFELEVBQWlCLGNBQWpCLEVBQWlDLGNBQWpDLENBQUQsRUFBbUQsQ0FBQyxjQUFELEVBQWlCLGNBQWpCLEVBQWlDLGNBQWpDLENBQW5ELENBTGMsRUFNZCxDQUFDLGNBQUQsRUFBaUIsY0FBakIsRUFBaUMsY0FBakMsQ0FOYyxFQU9kLENBQUMsY0FBRCxFQUFpQixjQUFqQixFQUFpQyxjQUFqQyxDQVBjLEVBUWQsQ0FBQyxjQUFELENBUmMsRUFTZCxDQUFD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QU0sOEJBQVVRLFNBQVYsR0FBc0IsQ0FBQ3JCLENBQUQsR0FBSyxDQUFMLEtBQVcsQ0FBWCxtQkFBNkJPLEtBQTdCLHdDQUFxRUEsS0FBM0Y7QUFDQTtBQW5DUjtBQXFDQVcsbUJBQU9DLE1BQVAsQ0FBY1AsT0FBT1osQ0FBUCxDQUFkLEVBQXlCYSxTQUF6QjtBQUNIO0FBQ0osS0E1R1U7QUE2R1hZLGdCQTdHVyx3QkE2R0VDLENBN0dGLEVBNkdLO0FBQUEsb0NBQ3dCQSxFQUFFQyxhQUFGLENBQWdCQyxPQUR4QztBQUFBLFlBQ0pMLEtBREkseUJBQ0pBLEtBREk7QUFBQSxZQUNHTSxPQURILHlCQUNHQSxPQURIO0FBQUEsWUFDWUMsT0FEWix5QkFDWUEsT0FEWjs7O0FBR1osWUFBSUEsV0FBV0EsWUFBWSxFQUEzQixFQUErQjtBQUMzQixnQkFBTUMsUUFBUSx3QkFBU0QsT0FBVCxDQUFkO0FBQ0EsZ0JBQU1FLFdBQVcsdUJBQVEsS0FBS0QsS0FBYixDQUFqQjtBQUNBLGdCQUFJQyxhQUFhRixPQUFqQixFQUEwQjtBQUMxQixzQ0FBV0MsS0FBWDtBQUNILFNBTEQsTUFLTztBQUNILGdCQUFNbkIsU0FBUyxLQUFLcUIsSUFBTCxDQUFVQyxTQUFWLENBQW9CTCxPQUFwQixFQUE2QnhCLEtBQTdCLENBQW1DQyxHQUFuQyxDQUF1Q00sTUFBdkMsQ0FBOEN1QixHQUE5QyxDQUFrRCxVQUFDQyxHQUFEO0FBQUEsdUJBQVNBLElBQUloQixHQUFiO0FBQUEsYUFBbEQsQ0FBZjtBQUNBLHFDQUFhUixNQUFiLEVBQXFCVyxLQUFyQjtBQUNIO0FBQ0o7QUF6SFUsQyIsImZpbGUiOiJpbWFnZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKmVzbGludC1kaXNhYmxlICovXHJcbmltcG9ydCB7IHByZXZpZXdJbWFnZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2luZGV4JztcclxuaW1wb3J0IHsgZ2V0Um91dGUsIG5hdmlnYXRlVG8gfSBmcm9tICcuLi8uLi8uLi91dGlscy9nZXRSb3V0ZSc7XHJcbmltcG9ydCBnZXRQYWdlIGZyb20gJy4uLy4uLy4uL3V0aWxzL2dldFBhZ2UnO1xyXG5cclxuY29uc3QgRU5VTV9USEVNRSA9IFsnemVybycsICdvbmUnLCAndHdvJywgJ3RocmVlJywgJ2ZvdXInLCAnZml2ZScsICdzaXgnLCAnc2V2ZW4nLCAnZWlnaHQnXTtcclxuY29uc3QgQ0xJUF9TSVpFID0gW1xyXG4gICAgJz93PTY5MCZoPTY5MCcsXHJcbiAgICAnP3c9NjkwJmg9NTEwJyxcclxuICAgICc/dz0zMzYmaD0yNTInLFxyXG4gICAgJz93PTIyMCZoPTE2NCcsXHJcbiAgICBbWyc/dz0zNjMmaD00ODInLCAnP3c9MzA5Jmg9MjMxJywgJz93PTMwOSZoPTIzMSddLCBbJz93PTM4OCZoPTUxNCcsICc/dz0yODQmaD0yMTQnLCAnP3c9Mjg0Jmg9MjE0J11dLFxyXG4gICAgWyc/dz02OTAmaD0zODgnLCAnP3c9MzM2Jmg9MjUyJywgJz93PTMzNiZoPTI1MiddLFxyXG4gICAgWyc/dz02OTAmaD0zODgnLCAnP3c9MjE4Jmg9MTY0JywgJz93PTIxOCZoPTE2NCddLFxyXG4gICAgWyc/dz0xNjAmaD0xNjAnXSxcclxuICAgIFsnP3c9MzM2Jmg9NDQ4J10sXHJcbl07XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBpbWFnZXNWaWV3U3RhdGUobW9kdWxlcyA9IFtdKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG1vZHVsZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBtb2R1bGVzW2ldO1xyXG4gICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2ltYWdlcycpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmcgPSBtb2R1bGVzW2ldLnByb3BzLmNmZztcclxuICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nLnRoZW1lID09PSB1bmRlZmluZWQpIHNldHRpbmcudGhlbWUgPSAnMic7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmltYWdlc0NvbmZTdGF0ZShzZXR0aW5nKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW1hZ2VTdGF0ZShzZXR0aW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBpbWFnZXNDb25mU3RhdGUoc2V0dGluZykge1xyXG4gICAgICAgIGNvbnN0IHsgdGhlbWUsIGhhc01vcmUgPSB0cnVlLCBpbWFnZXMgfSA9IHNldHRpbmc7XHJcbiAgICAgICAgY29uc3Qgdmlld1N0YXRlID0ge1xyXG4gICAgICAgICAgICBzdHlsZU5hbWU6ICcnLFxyXG4gICAgICAgICAgICBtYXhOdW06IDAsXHJcbiAgICAgICAgICAgIHNob3dNb3JlOiAhMCxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHN3aXRjaCAodGhlbWUpIHtcclxuICAgICAgICAgICAgY2FzZSAnMSc6XHJcbiAgICAgICAgICAgIGNhc2UgJzInOlxyXG4gICAgICAgICAgICBjYXNlICczJzpcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5zdHlsZU5hbWUgPSBFTlVNX1RIRU1FW3RoZW1lXTtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5zaG93TW9yZSA9IGhhc01vcmUgJiYgaW1hZ2VzLmxlbmd0aCA+IHRoZW1lICogMjtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5tYXhOdW0gPSB2aWV3U3RhdGUuc2hvd01vcmUgPyB0aGVtZSAqIDIgOiBpbWFnZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8qIDHlt6Yy5Y+zICovXHJcbiAgICAgICAgICAgIGNhc2UgJzQnOlxyXG4gICAgICAgICAgICAgICAgLy8g6L2s5Li76aKY5bCP5qCH5Yiw5qC35byP5ZCN56ewXHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGUuc3R5bGVOYW1lID0gaW1hZ2VzWzBdLnRpdGxlID8gYCR7RU5VTV9USEVNRVt0aGVtZV19cGx1c2AgOiBFTlVNX1RIRU1FW3RoZW1lXTtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5zaG93TW9yZSA9IGhhc01vcmUgJiYgaW1hZ2VzLmxlbmd0aCA+IDM7XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGUubWF4TnVtID0gdmlld1N0YXRlLnNob3dNb3JlID8gMyA6IGltYWdlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLyogMeS4ijLkuIsgKi9cclxuICAgICAgICAgICAgY2FzZSAnNSc6XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGUuc3R5bGVOYW1lID0gRU5VTV9USEVNRVt0aGVtZV07XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGUuc2hvd01vcmUgPSBoYXNNb3JlICYmIGltYWdlcy5sZW5ndGggPiAzO1xyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRlLm1heE51bSA9IHZpZXdTdGF0ZS5zaG93TW9yZSA/IDMgOiBpbWFnZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIC8qIDHkuIoz5LiLICovXHJcbiAgICAgICAgICAgIGNhc2UgJzYnOlxyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRlLnN0eWxlTmFtZSA9IEVOVU1fVEhFTUVbdGhlbWVdO1xyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRlLnNob3dNb3JlID0gaGFzTW9yZSAmJiBpbWFnZXMubGVuZ3RoID4gNDtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5tYXhOdW0gPSB2aWV3U3RhdGUuc2hvd01vcmUgPyA0IDogaW1hZ2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAvKiAx6KGMNOW8oCAqL1xyXG4gICAgICAgICAgICBjYXNlICc3JzpcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5zdHlsZU5hbWUgPSBFTlVNX1RIRU1FW3RoZW1lXTtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5zaG93TW9yZSA9IGhhc01vcmUgJiYgaW1hZ2VzLmxlbmd0aCA+IDQ7XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RhdGUubWF4TnVtID0gdmlld1N0YXRlLnNob3dNb3JlID8gNCA6IGltYWdlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgLyog5Y+M5Zu+ICovXHJcbiAgICAgICAgICAgIGNhc2UgJzgnOlxyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRlLnN0eWxlTmFtZSA9IEVOVU1fVEhFTUVbdGhlbWVdO1xyXG4gICAgICAgICAgICAgICAgdmlld1N0YXRlLnNob3dNb3JlID0gaGFzTW9yZSAmJiBpbWFnZXMubGVuZ3RoID4gMjtcclxuICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5tYXhOdW0gPSB2aWV3U3RhdGUuc2hvd01vcmUgPyAyIDogaW1hZ2VzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3QuYXNzaWduKHNldHRpbmcsIHZpZXdTdGF0ZSk7XHJcbiAgICB9LFxyXG4gICAgaW1hZ2VTdGF0ZSh7IGltYWdlcywgdGhlbWUsIHN0eWxlTmFtZSB9KSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGltYWdlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCB2aWV3U3RhdGUgPSB7XHJcbiAgICAgICAgICAgICAgICBzcmM6IGltYWdlc1tpXS5zcmMsXHJcbiAgICAgICAgICAgICAgICBpdGVtQ2xhc3M6ICcnLFxyXG4gICAgICAgICAgICAgICAgaXRlbUluZGV4OiAwLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBsZXQgaW5kZXggPSB+aSAlIDMgPT09IDAgPyAzIDogLSh+aSAlIDMpO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoZW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICcxJzpcclxuICAgICAgICAgICAgICAgIGNhc2UgJzInOlxyXG4gICAgICAgICAgICAgICAgY2FzZSAnMyc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLnNyYyArPSBDTElQX1NJWkVbdGhlbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5pdGVtQ2xhc3MgPSB+aSAlIHRoZW1lID09PSAwID8gYG1vZC1saS1ib3gtJHt0aGVtZX0gbW9kLWxpLWJveC1sYXN0YCA6IGBtb2QtbGktYm94LSR7dGhlbWV9YDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIC8qIDHlt6Yy5Y+zICovXHJcbiAgICAgICAgICAgICAgICBjYXNlICc0JzpcclxuICAgICAgICAgICAgICAgICAgICB2aWV3U3RhdGUuc3JjICs9IENMSVBfU0laRVs0XVtzdHlsZU5hbWUuaW5kZXhPZigncGx1cycpID4gLTEgPyAxIDogMF1baW5kZXggLSAxXTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3U3RhdGUuaXRlbUluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLml0ZW1DbGFzcyA9IGluZGV4ID4gMSA/IGBtb2QtbGktYm94LSR7c3R5bGVOYW1lfS0ke2luZGV4fSBtb2QtbGktYm94LWxhc3RgIDogYG1vZC1saS1ib3gtJHtzdHlsZU5hbWV9LSR7aW5kZXh9YDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIC8qIDHkuIoy5LiLICovXHJcbiAgICAgICAgICAgICAgICBjYXNlICc1JzpcclxuICAgICAgICAgICAgICAgICAgICB2aWV3U3RhdGUuaXRlbUluZGV4ID0gaW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLnNyYyArPSBDTElQX1NJWkVbdGhlbWVdW2luZGV4IC0gMV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLml0ZW1DbGFzcyA9IGluZGV4ID4gMiA/IGBtb2QtbGktYm94LSR7c3R5bGVOYW1lfS0ke2luZGV4fSBtb2QtbGktYm94LWxhc3RgIDogYG1vZC1saS1ib3gtJHtzdHlsZU5hbWV9LSR7aW5kZXh9YDtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIC8qIDHkuIoz5LiLICovXHJcbiAgICAgICAgICAgICAgICBjYXNlICc2JzpcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IH5pICUgNCA9PT0gMCA/IDQgOiAtKH5pICUgNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLnNyYyArPSBDTElQX1NJWkVbdGhlbWVdW2luZGV4IC0gMV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLml0ZW1JbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5pdGVtQ2xhc3MgPSBpbmRleCA+IDMgPyBgbW9kLWxpLWJveC0ke3N0eWxlTmFtZX0tJHtpbmRleH0gbW9kLWxpLWJveC1sYXN0YCA6IGBtb2QtbGktYm94LSR7c3R5bGVOYW1lfS0ke2luZGV4fWA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvKiAx6KGMNOW8oCAqL1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnNyc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLnNyYyArPSBDTElQX1NJWkVbdGhlbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdTdGF0ZS5pdGVtQ2xhc3MgPSB+aSAlIDQgPT09IDAgPyBgbW9kLWxpLWJveC0ke3RoZW1lfSBtb2QtbGktYm94LWxhc3RgIDogYG1vZC1saS1ib3gtJHt0aGVtZX1gO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgLyog5Y+M5Zu+ICovXHJcbiAgICAgICAgICAgICAgICBjYXNlICc4JzpcclxuICAgICAgICAgICAgICAgICAgICB2aWV3U3RhdGUuc3JjICs9IENMSVBfU0laRVt0aGVtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld1N0YXRlLml0ZW1DbGFzcyA9IH5pICUgMiA9PT0gMCA/IGBtb2QtbGktYm94LSR7dGhlbWV9IG1vZC1saS1ib3gtbGFzdGAgOiBgbW9kLWxpLWJveC0ke3RoZW1lfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihpbWFnZXNbaV0sIHZpZXdTdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG9uSW1hZ2VDbGljayhlKSB7XHJcbiAgICAgICAgY29uc3QgeyBpbmRleCwgY3VycmVudCwgcGFnZWtleSB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XHJcblxyXG4gICAgICAgIGlmIChwYWdla2V5ICYmIHBhZ2VrZXkgIT09ICcnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gZ2V0Um91dGUocGFnZWtleSk7XHJcbiAgICAgICAgICAgIGNvbnN0IF9wYWdla2V5ID0gZ2V0UGFnZSh0aGlzLnJvdXRlKTtcclxuICAgICAgICAgICAgaWYgKF9wYWdla2V5ID09PSBwYWdla2V5KSByZXR1cm47XHJcbiAgICAgICAgICAgIG5hdmlnYXRlVG8ocm91dGUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGltYWdlcyA9IHRoaXMuZGF0YS5wYWdlX2RhdGFbY3VycmVudF0ucHJvcHMuY2ZnLmltYWdlcy5tYXAoKGltZykgPT4gaW1nLnNyYyk7XHJcbiAgICAgICAgICAgIHByZXZpZXdJbWFnZShpbWFnZXMsIGluZGV4KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG59O1xyXG4iXX0=