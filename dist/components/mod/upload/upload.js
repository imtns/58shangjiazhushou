"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var t=0,e=Array(a.length);t<a.length;t++)e[t]=a[t];return e}return Array.from(a)}var host="https://yaofa.58.com";Component({data:{uploading:!1,vm:[],images:[]},properties:{uploadingImage:{type:String,value:"https://static.58.com/lbg/mengchong/image/element/upimg_loading_1.gif",observer:function(a,t){a||this.setData({uploadingImage:t})}},uploadApi:{type:String,value:"/file/upload/"}},methods:{onUploadHander:function(){if(!this.uploading){var a=this,t=this.data.vm.length||0;wx.chooseImage({success:function(e){var n=e.tempFilePaths.length,o=[].concat(_toConsumableArray(a.data.vm)),i=[].concat(_toConsumableArray(a.data.images));o=a.batchAddArray(o,n,a.data.uploadingImage),a.setData({uploading:!0,vm:[].concat(_toConsumableArray(o))}),a.triggerEvent("changeimages",{uploading:a.data.uploading}),e.tempFilePaths.map(function(e,r){a.uploadFile(e,function(s,c){s?(wx.showToast({title:s||"图片上传失败，请重试",icon:"none"}),o.splice(t+r,1)):(o.splice(t+r,1,e),i.push(c.content)),a.setData({vm:[].concat(_toConsumableArray(o)),images:[].concat(_toConsumableArray(i))}),a.triggerEvent("changeimages",{uploading:!1,images:a.data.images}),n-1===r&&a.setData({uploading:!1})})})}})}},onCancelImage:function(a){if(!this.data.uploading){var t=a.currentTarget.dataset.index,e=this,n=this.data.vm,o=this.data.images;n.splice(t,1),o.splice(t,1),e.setData({vm:[].concat(_toConsumableArray(n)),images:[].concat(_toConsumableArray(o))}),e.triggerEvent("changeImages",{images:this.data.images})}},uploadFile:function(a,t){wx.uploadFile({url:host+this.data.uploadApi,filePath:a,name:"content",success:function(a){var e=a.data,n=a.statusCode;try{e=JSON.parse(e)}catch(a){return void(t&&t("response incorrect format."))}if(200===n&&100==e.state)return void(t&&t(null,e.data));t&&t(e.msg)},fail:function(){t&&t("上传接口异常")}})},batchAddArray:function(a,t,e){var n=a;if(n instanceof Array)for(var o=0;o<t;o++)n.push(e);return n}}});