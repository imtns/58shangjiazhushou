"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(i,a){try{var o=r[i](a),s=o.value}catch(e){return void t(e)}if(!o.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_mixin=require("./../mixin/index.js"),_mixin2=_interopRequireDefault(_mixin),_ajax=require("./../utils/ajax.js"),_url=require("./../utils/url.js"),_utils=require("./../utils/index.js"),_UploadFile=require("./../components/UploadFile.js"),_UploadFile2=_interopRequireDefault(_UploadFile),_globalService=require("./../utils/globalService.js"),_globalService2=_interopRequireDefault(_globalService),Index=function(e){function r(){var e,t,n,i;_classCallCheck(this,r);for(var a=arguments.length,o=Array(a),s=0;s<a;s++)o[s]=arguments[s];return t=n=_possibleConstructorReturn(this,(e=r.__proto__||Object.getPrototypeOf(r)).call.apply(e,[this].concat(o))),n.config={navigationBarTitleText:"编辑详情"},n.$repeat={},n.$props={imageUploader:{"xmlns:v-on":"",maxCount:"10",maxSize:"4",uploadtype:"1","xmlns:v-bind":"","v-bind:showDelete.once":"showImageDelete",showType:"order","v-bind:defaultImages.sync":"defaultImages"}},n.$events={imageUploader:{"v-on:changeimages":"setImages"}},n.components={imageUploader:_UploadFile2.default},n.data={form:{id:"",mpid:"",serviceName:"",pics:"",price:0,durationUnit:1,duration:0,serviceDetailInfo:"",serviceUserName:"",serviceTelphone:"",serviceStarttime:"",serviceEndtime:"",provinceStr:"",cityStr:"",areaStr:"",address:"",addressLongitude:"116.39722",addressLatitude:"39.90960",province:0,city:0,area:0,payType:1},showImageDelete:!1,defaultImages:[],region:"",canSubmit:!1},n.mixins=[_mixin2.default],n.methods={setImages:function(e){var r=e.images;if(r.length){var t=_slicedToArray(r,1);this.form.pics=t[0]}},save:function(){function e(){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canSubmit){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,r="",t=this.form,n={},Object.keys(t).forEach(function(e){t[e]&&(n[e]=t[e])}),this.validator(n),r=t.id?_url.SAVE_SERVICE:_url.INSERT_SERVICE,e.next=11,(0,_ajax.post)(r,n);case 11:_wepy2.default.navigateBack(),e.next=20;break;case 14:e.prev=14,e.t0=e.catch(2),this.errorHandler(e.t0),i="",i="object"===(void 0===e.t0?"undefined":_typeof(e.t0))?e.t0.message:e.t0,(0,_utils.alert)(i);case 20:case"end":return e.stop()}},e,this,[[2,14]])}));return e}(),setFormData:function(e,r){this.form[e]=r.detail.value},setLocation:function(){function e(){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_wepy2.default.chooseLocation();case 3:r=e.sent,t=r.address,n=r.latitude,i=r.longitude,Object.assign(this.form,{address:t,addressLatitude:n,addressLongitude:i}),this.$apply(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.errorHandler(e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return e}()},n.computed={region:function(){var e=this.form,r=e.provinceStr,t=e.cityStr,n=e.areaStr;return r&&t&&n?r+" "+t+" "+n:""},canSubmit:function(){var e=this,r=!0;return["serviceName","pics","price","durationUnit","duration","serviceStarttime","serviceEndtime","provinceStr","cityStr","areaStr","address","payType"].forEach(function(t){(0,_utils.isEmpty)(e.form[t])&&(r=!1)}),r}},i=t,_possibleConstructorReturn(n,i)}return _inherits(r,e),_createClass(r,[{key:"onLoad",value:function(){function e(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n=r.id,i=r.resourceGroup;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_wepy2.default.getStorageSync("current_mpid"),!n){e.next=5;break}return e.next=4,this.loadData(n);case 4:this.updateData();case 5:this.mpid=t,Object.assign(this.form,{resourceGroup:i,mpid:t}),this.$apply();case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"onShow",value:function(){var e=_globalService2.default.get("multiSelector"),r=e.province,t=e.city,n=e.area;r&&t&&n&&Object.assign(this.form,e)}},{key:"validator",value:function(e){var r=e.serviceStarttime,t=e.serviceEndtime,n=e.price,i=e.duration,a=e.durationUnit;if(r>t)throw new Error("预约结束时间必须大于开始时间");if(n>1e5)throw new Error("输入价格不超过10万");if(i>1440&&1===a)throw new Error("输入时长不得大于1440分钟");if(i>24&&2===a)throw new Error("输入时长不得大于24小时")}},{key:"loadData",value:function(){function e(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,i,a,o,s,u,c,l,p,d,f,m,v,y,h,_,g,b,S,w,x,j;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.mpid,e.next=4,(0,_ajax.get)(_url.LOAD_SERVICE+r,{mpid:t});case 4:n=e.sent,i=n.data,a=i.serviceName,o=i.pics,s=i.price,u=i.durationUnit,c=i.duration,l=i.serviceDetailInfo,p=i.serviceUserName,d=i.serviceTelphone,f=i.serviceStarttime,m=i.serviceEndtime,v=i.provinceStr,y=i.cityStr,h=i.areaStr,_=i.address,g=i.addressLongitude,b=i.addressLatitude,S=i.province,w=i.city,x=i.area,j=i.payType,Object.assign(this.form,{id:r,mpid:t,serviceName:a,pics:o,price:s,durationUnit:u,duration:c,serviceDetailInfo:l,serviceUserName:p,serviceTelphone:d,serviceStarttime:f,serviceEndtime:m,provinceStr:v,cityStr:y,areaStr:h,address:_,addressLongitude:g,addressLatitude:b,province:S,city:w,area:x,payType:j}),this.defaultImages=[(0,_utils.picSrcDomain)()+o],this.$apply(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.errorHandler(e.t0);case 15:case"end":return e.stop()}},e,this,[[0,12]])}));return e}()},{key:"updateData",value:function(){var e=_globalService2.default.get("orderComponent");_globalService2.default.set("orderComponent",Object.assign(e,this.form))}}]),r}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/orderComponentEdit"));