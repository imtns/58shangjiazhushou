"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){function n(i,a){try{var r=t[i](a),o=r.value}catch(e){return void s(e)}if(!r.done)return Promise.resolve(o).then(function(e){n("next",e)},function(e){n("throw",e)});e(o)}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_utils=require("./../utils/index.js"),_ajax=require("./../utils/ajax.js"),Home=function(e){function t(){var e,s,n,i;_classCallCheck(this,t);for(var a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];return s=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),n.config={navigationBarTitleText:"首页",disableScroll:!0},n.data={business:{mps:[],name:"您的姓名",miniProgramName:"您还没购买小程序",unread:0,mpCount:0,progressText:"您还没有购买小程序",nexttask:0,changeMP:!1,canConfirm:!1,selected:{id:0},chosedId:0},items:[{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-my.png",text:"我的小程序"},{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-upload.png",text:"上传素材"},{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-order.png",text:"订单管理"},{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-register.png",text:"微信注册信息"},{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-progress.png",text:"完成度"},{iconPath:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/icon-advice.png",text:"意见反馈"}]},n.methods={link:function(e){4!==e?this.checkBeforeJump(e):_wepy2.default.navigateTo({url:"feedback"})},checkProgress:function(){if(!this.business.mpCount)return void(0,_utils.alert)("您还未购买小程序，请登录e.58.com进行购买","提示");switch(this.business.nexttask){case 2:_wepy2.default.navigateTo({url:"AppEdit"});break;case 3:_wepy2.default.navigateTo({url:"UploadInfo"});break;case 4:2===this.business.selected.app_type?(_wepy2.default.setStorageSync("registMappid",this.business.selected.id),_wepy2.default.navigateTo({url:"registMainAccount"})):_wepy2.default.navigateTo({url:"progress"});break;case 5:1===this.business.selected.app_type?_wepy2.default.navigateTo({url:"progress"}):_wepy2.default.navigateTo({url:"myMp"});break;case 6:case 7:case 8:case 9:_wepy2.default.navigateTo({url:"progress"})}this.$apply()},changeAction:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,s,n,i,a,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.business=Object.assign({},this.business,{changeMP:!0}),e.next=3,(0,_ajax.post)("/mplogic/mymplist");case 3:t=e.sent,s=t.data,n=s.mpinfos,this.business=Object.assign({},this.business,{mps:n}),this.business.mps.length>0&&(i=this.business.mps.filter(function(e){return e.id!==r.business.selected.id}),a=i.map(function(e){return r.formatedMp(e)}),this.business=Object.assign({},this.business,{mps:a,chosedId:0,canConfirm:!1})),this.$apply(),console.log("this.business.mps",this.business.mps);case 10:case"end":return e.stop()}},e,this)}));return e}(),bindHideMask:function(){this.business=Object.assign({},this.business,{changeMP:!1,canConfirm:!1}),this.$apply()},selectMp:function(e){this.business=Object.assign({},this.business,{chosedId:e.id,canConfirm:!0}),console.log("点击",this.business),this.$apply()},confirmAction:function(){this.business.selected.id&&(this.setGlobalMpId(this.business.chosedId),this.loadData(),this.hideMask())}},i=s,_possibleConstructorReturn(n,i)}return _inherits(t,e),_createClass(t,[{key:"hideMask",value:function(){this.business=Object.assign({},this.business,{changeMP:!1,canConfirm:!1}),this.$apply()}},{key:"onLoad",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_utils.sleep)();case 2:console.log("onLoad");case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"onShow",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:this.setGlobalMpId(this.business.selected.id);case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"formatedMp",value:function(e){var t=e;return t.headImg&&-1===t.headImg.indexOf("http")&&(t.headImg="https://pic1.58cdn.com.cn"+t.headImg),t}},{key:"onShareAppMessage",value:function(e){return"button"===e.from&&console.log(e.target),{title:"高效管理商家小程序的一站式服务工具",path:"/pages/home",imageUrl:"https://static.58.com/lbg/shangjiaxcxht/zhushou/img/share.png",success:function(e){console.log(e)},fail:function(e){console.log(e)}}}},{key:"loadData",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,s,n,i,a,r,o,u,c,p,l,h,g,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={mpid:_wepy2.default.getStorageSync("current_mpid")||""},e.next=4,(0,_ajax.post)("/mplogic/index",t);case 4:s=e.sent,n=s.data,console.log("loadData",n),i=n.username,a=void 0===i?"":i,r=n.mpinfo,o=void 0===r?{}:r,u=n.unread,c=void 0===u?"":u,p=n.count,l=void 0===p?0:p,h=n.nexttask,g=void 0===h?"":h,f=this.formatedMp(o),this.business=Object.assign({},this.business,{name:a,miniProgramName:o.nickName||"您还没购买小程序",unread:c,mpCount:l,selected:f}),g&&this.setNextTask(g),console.log("this.business",this.business),this.$apply(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log("e",e.t0);case 18:case"end":return e.stop()}},e,this,[[0,15]])}));return e}()},{key:"setGlobalMpId",value:function(e){e&&_wepy2.default.setStorageSync("current_mpid",e)}},{key:"checkBeforeJump",value:function(e){if(console.log("this.business.selected.",this.business.selected),!this.business.mpCount)return void(0,_utils.alert)("您还未购买小程序，请登录e.58.com进行购买","提示");switch(e){case 0:_wepy2.default.navigateTo({url:"myMp"});break;case 1:_wepy2.default.navigateTo({url:"UploadInfo"});break;case 2:if(1===this.business.selected.app_type)return void(0,_utils.alert)("当前小程序为优享小程序，不用提交注册信息","提示");1===this.business.selected.sign?_wepy2.default.navigateTo({url:"registed"}):(_wepy2.default.setStorageSync("registMappid",this.business.selected.id),_wepy2.default.navigateTo({url:"registMainAccount"}));break;case 3:_wepy2.default.navigateTo({url:"progress"});break;case 4:_wepy2.default.navigateTo({url:"feedback"})}}},{key:"setNextTask",value:function(e){switch(this.business=Object.assign({},this.business,{nexttask:e}),e){case 2:this.business.progressText="当前小程序未添加小程序信息";break;case 3:this.business.progressText="当前小程序还未上传素材";break;case 4:1===this.business.selected.app_type?this.business.progressText="当前小程序信息已完善":this.business.progressText="当前小程序还未填写注册信息";break;case 5:1===this.business.selected.app_type?this.business.progressText="当前小程序信息已完善":this.business.progressText="当前小程序还未授权";break;case 6:case 7:case 8:case 9:this.business.progressText="当前小程序信息已完善"}this.$apply()}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Home,"pages/home"));