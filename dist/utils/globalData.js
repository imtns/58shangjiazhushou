"use strict";function clearSessionId(){Object.assign(this.globalData,{iv:null,sessionId:null,userInfo:null})}function getSessionId(e){var t=this,o=this.globalData.sessionId;if(o)return void e(null,o);this.getCode(function(o,n,s){if(o)return void console.log(o);(0,_ajax.get)("/wechat/getSession/",{code:n},function(o,n){if(o)return void e(o);var a=n.data,i=n.code;t.globalData.userInfo=s,t.globalData.sessionId=a.session,1===i&&t.regist(),e(null,a.session)})})}function getCode(e){wx.login({success:function(t){var o=wx.getStorageSync("getUserInfo"),n=o.userInfo;e(null,t.code,n)},fail:function(t){console.log("wx.login 接口调用失败，将无法正常使用开放接口等服务",t),e(t)}})}function getUserInfo(e){var t=this,o=t.globalData.userInfo;if(o)return void e(null,o);wx.getUserInfo({withCredentials:!0,success:function(o){var n=o.encryptedData,s=o.iv,a=o.userInfo;t.globalData.encryptedData=n,t.globalData.userInfo=a,t.globalData.iv=s,e(null,a)},fail:function(o){t.openSetting(function(t,o){if(t)return void console.log(t);e(null,o)})}})}function openSetting(e){var t=this;wx.showModal({title:"注意",content:"由于您拒绝了授权，后续页面可能无法正常访问。您可以进入设置页面开启授权。",success:function(o){if(!o.confirm)return void wx.reLaunch({url:"/pages/index/index"});wx.openSetting({success:function(o){o.authSetting["scope.userInfo"]||e("设置失败"),t.getCode(function(t,o,n){e(null,n)})}})}})}function regist(){var e=this,t=e.globalData,o=t.iv,n=t.encryptedData,s=t.sessionId;console.log(e.globalData),(0,_ajax.post)("/wechat/decodeUserInfo/",{iv:o,sessionId:s,encryptedData:n},function(e,t){console.log(e,t),e&&alert("注册失败，请删除小程序后重新打开。")})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMappDetail=exports.globalData=void 0,exports.clearSessionId=clearSessionId,exports.getCode=getCode,exports.getUserInfo=getUserInfo,exports.openSetting=openSetting,exports.regist=regist;var _ajax=require("./ajax.js"),globalData=exports.globalData={iv:null,sessionId:null,userInfo:null,encryptedData:null,information:{},extConfig:{},pageData:{},pageList:{},modules:{},isIphoneX:!1,tabMode:0,tabBar:{}},getMappDetail=exports.getMappDetail=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.userId,o=e.appId,n=e.releaseId;return new Promise(function(e,s){(0,_ajax.get)("/search/detail",{userId:t,appId:o,releaseId:n},function(t,o){if(t||!o)return alert("该小程序已下线！"),void s(t);e(o)})})},utils={globalData:globalData,clearSessionId:clearSessionId,getSessionId:getSessionId,getCode:getCode,getUserInfo:getUserInfo,openSetting:openSetting,regist:regist};exports.default=utils;